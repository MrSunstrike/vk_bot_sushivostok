import vk_api
from vk_api.longpoll import VkLongPoll, VkEventType
from dotenv import load_dotenv
from os import getenv
import random

load_dotenv()

TOKEN = getenv("TOKEN")

win_words = ["–≤—ã–π–≥—Ä", "–≤—ã–∏–≥—Ä–∞", "–ø–æ–±–µ–¥–∏–ª", "–ø—Ä–∏–∑"]


def get_answer(message):
    if "–∑–∞–∫–∞–∑" in message.lower():
        return ("–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–µ–ºüëã\n"
                "–ß—Ç–æ–±—ã –æ—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–∑–≤–æ–Ω–∏—Ç–µ –≤ –±–ª–∏–∂–∞–π—à–∏–π —Ñ–∏–ª–∏–∞–ª –∏–ª–∏ –≤–æ—Å–ø–æ–ª—å–∑—É–π—Ç–µ—Å—å –Ω–∞—à–∏–º —Å–∞–π—Ç–æ–º.\n\n"
                "‚òé–ö–æ–Ω—Ç–∞–∫—Ç—ã —Ñ–∏–ª–∏–∞–ª–æ–≤: https://sushivostok.com/kontakty/\n\n"
                "üñ•Ô∏è–ú–µ–Ω—é –Ω–∞ –Ω–∞—à–µ–º —Å–∞–π—Ç–µ: https://sushivostok.com/products/sety/\n\n"
                "‚ö†–ö —Å–æ–∂–∞–ª–µ–Ω–∏—é, –≤ –≥—Ä—É–ø–ø–µ –í–ö–æ–Ω—Ç–∞–∫—Ç–µ, –º—ã —Ç–µ—Ö–Ω–∏—á–µ—Å–∫–∏ –Ω–µ –º–æ–∂–µ–º –ø—Ä–∏–Ω—è—Ç—å –∑–∞–∫–∞–∑")

    for keyword in win_words:
        if keyword in message.lower():
            return ("–ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É–µ–ºüëã\n"
                    "–ï—Å–ª–∏ –≤—ã –≤—ã–∏–≥—Ä–∞–ª–∏ –≤ –Ω–∞—à–µ–º –∫–æ–Ω–∫—É—Ä—Å–µ, —Ç–æ, –ø–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–∑–≤–æ–Ω–∏—Ç–µ –≤ –±–ª–∏–∂–∞–π—à–∏–π —Ñ–∏–ª–∏–∞–ª –∏ –¥–æ–≥–æ–≤–æ—Ä–∏—Ç–µ—Å—å "
                    "–æ–± –∏–∑–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–∏ –≤–∞—à–µ–≥–æ –ø–æ–¥–∞—Ä–æ—á–Ω–æ–≥–æ —Å–µ—Ç–∞. –í –∫–∞—á–µ—Å—Ç–≤–µ –¥–æ–∫–∞–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –ø—Ä–∏–∑–∞, "
                    "–ø—Ä–µ–¥—ä—è–≤–∏—Ç–µ –ø—É–±–ª–∏–∫–∞—Ü–∏—é —Å –≤–∞—à–µ–π –ø–æ–±–µ–¥–æ–π –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞\n\n"
                    "‚òé–ö–æ–Ω—Ç–∞–∫—Ç—ã —Ñ–∏–ª–∏–∞–ª–æ–≤: https://sushivostok.com/kontakty/")


# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è VK API –∏ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è
vk_session = vk_api.VkApi(token=TOKEN)
vk = vk_session.get_api()
longpoll = VkLongPoll(vk_session)

# –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª –±–æ—Ç–∞
for event in longpoll.listen():
    if event.type == VkEventType.MESSAGE_NEW and event.to_me:
        # –ü–æ–ª—É—á–∞–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ, –æ—Ç–ø—Ä–∞–≤–∏–≤—à–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ
        user_id = event.user_id
        user_info = vk.users.get(user_ids=user_id)[0]
        first_name = user_info['first_name']

        # –ü–æ–ª—É—á–∞–µ–º —Ç–µ–∫—Å—Ç —Å–æ–æ–±—â–µ–Ω–∏—è
        message_text = event.text

        # –ü–æ–ª—É—á–∞–µ–º –æ—Ç–≤–µ—Ç
        response = get_answer(message_text)

        # –§–æ—Ä–º–∏—Ä—É–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –∏–º–µ–Ω–∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç–µ–ª—è
        message = f"{first_name}, {response}"

        # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç–≤–µ—Ç —Å —Å–ª—É—á–∞–π–Ω—ã–º –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–º
        vk.messages.send(
            user_id=event.user_id,
            message=message,
            random_id=random.randint(1, 1000)  # –î–æ–±–∞–≤–ª—è–µ–º random_id
        )

